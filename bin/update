#!/bin/sh

function usage {
	echo "Usage: $0 [-f] [ -h]"
	echo "  -f : Move existing files out of the way, then symlink"
	echo "  -h : This help message"
}

if [ "$1" == "-h" ] ; then
	usage
	exit
fi

force=0
if [ "$1" == "-f" ] ; then
	force=1
fi

BASE=$(readlink -f $(dirname $0)/..)

echo BASE=$BASE

for f in $BASE/* ; do
	ff=$(basename $f)

	# skip these files
	if [ "$ff" == "bin" ] || [ "$ff" == "README.md" ] ; then continue ; fi

	echo -n "[$ff] "
	if [ -L "$HOME/.$ff" ] || [ ! -f "$HOME/.$ff" ] ; then
		# already a symlink or does not exist
		echo "$HOME/.$ff -> $f"
		ln -sf $f $HOME/.$ff
	elif [ -f "$HOME/.$ff" ] && [ "$force" -eq 1 ] ; then
		# file exists, and we were told to symlink anyway
		echo "Moving ~/.$ff -> ~/.$ff.dot ; Symlinking ~/.$ff -> $f"
		mv $HOME/.$ff $HOME/.$ff.dot && ln -sf $f $HOME/.$ff
	else
		echo "Already exists and is not a symlink. Skipping."
	fi
done
