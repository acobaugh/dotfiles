#!/bin/sh


function usage {
	echo "Usage: $0 [-f] [ -h]"
	echo "  -f : Move existing files out of the way, then symlink"
	echo "  -h : This help message"
}

if [ "$1" == "-h" ] ; then
	usage
	exit
fi

force=0
if [ "$1" == "-f" ] ; then
	force=1
fi

BASE=$(readlink -f $(dirname $0)/..)

dotfiles=""
test -f $BASE/bin/config && . $BASE/bin/config
echo "dotfiles=$dotfiles"
echo BASE=$BASE

for f in $dotfiles ; do
	echo -n "[$f] "
	if [ ! -e $BASE/$f ] ; then
		# file specified in config but does not exist in repo
		echo "Not in repo. Skipping."
		continue
	fi
	if [ -L "$HOME/.$f" ] || [ ! -f "$HOME/.$f" ] ; then
		# already a symlink or does not exist
		echo "$HOME/.$f -> $BASE/$f"
		ln -sf $BASE/$f $HOME/.$f
	elif [ -f "$HOME/.$f" ] && [ "$force" -eq 1 ] ; then
		# file exists, and we were told to symlink anyway
		echo "Moving ~/.$f -> ~/.$f.dot ; Symlinking ~/.$f -> $BASE/$f"
		mv $HOME/.$f $HOME/.$f.dot && ln -sf $BASE/$f $HOME/.$f
	else
		echo "Already exists and is not a symlink. Skipping."
	fi
done
